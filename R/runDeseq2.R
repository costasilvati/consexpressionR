#' Execute DESeq2 DGE default analysis
#' is configured to read only kallisto files, and count data
#'
#' @param countMatrix original table count or abundance data
#' @param designExperiment replicate and treatment by samples
#' @param pathDirRuns parent directory that contains one folder with all kallisto output
#' @param pathReportFile file path with report by sample, conditions and runs
#' @param subDirRuns sub dir by pathDirRun
#' @param fileKallisto file output kallisto, exemaple: "abundance.tsv" or "quant.sf.gz"
#' @param fitTypeParam either "parametric", "local", "mean", or "glmGamPoi" for the type of fitting of dispersions to the mean intensity
#'
#' @return extracted results from DESeq2 (generated by DESeq2::results function)
#' @export
#' @import DESeq2
#'
#' @examples
#' df <- readCountFile(tableCountPath="data/table_count_df.csv",
#'                     split=",")
#' groupNameModel = c("BM","JJ")
#' numberReplicsModel = 3
#' designExperimentModel <- rep(groupNameModel, each = numberReplicModel)
#' toolResult <- NULL
#' toolResult$deseq2 <- runDeseq2(countMatrix = df,
#'                                groupName = groupNameModel,
#'                                numberReplics = numberReplicsModel)
runDeseq2 <- function(countMatrix,
                      groupName,
                      numberReplics,
                      designExperiment,
                      fitTypeParam = "local",
                      pathDirRuns = ".",
                      pathReportFile = "report_txi.txt",
                      subDirRuns = "dir_runs",
                      fileKallisto = "abundance.tsv"){
  colDat <- NULL
  colDat$condiction <- as.factor(rep(groupName, each=numberReplics))
  colDat$type <- as.factor(rep(groupName, each=numberReplics))
  colDat <- as.data.frame(colDat, row.names = colnames(countMatrix))
  dds<-DESeqDataSetFromMatrix(countMatrix,
                              colData = colDat,
                              design = ~condiction)
  dds$condition <- factor(dds$condiction, levels = groupName)
  if(typeof(countMatrix) == "double"){
    print("Dataset isn't COUNT data")
    dds <- abundanceKallistoImport (pathReportRuns = pathDirRuns,
                                    pathReportFile = pathReportFile,
                                    dirRuns = subDirRuns,
                                    fileKallistoAbundance = fileKallisto,
                                    conditionList = designExperiment)
    dds <- DESeq2::DESeq(dds, fitType = fitTypeParam)
  }else{ # testar count data
    print("Dataset is COUNT data")
    dds <- DESeq2::DESeq(dds, fitType = fitTypeParam)
  }

  res <- DESeq2::results(dds, contrast = c("condiction",groupName))
  resOrdered <- res[order(res$pvalue),]
  dfDeseq2 <- as.data.frame(resOrdered)
  return(dfDeseq2)
}
